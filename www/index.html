<!DOCTYPE html>
<html lang="en" ng-app="app" ng-csp>
<head>
    <meta charset="utf-8" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />

    <!-- CSS dependencies -->
    <link rel="stylesheet" href="lib/onsen/css/onsenui.css" />
    <link rel="stylesheet" href="lib/onsen/css/onsen-css-components.css" />
    <link rel="stylesheet" href="css/index.css" />

    <script src="js/index.js"></script>
    <title>Dicionário de Crente</title>
</head>

<body>
    <ons-navigator id="appNavigator" swipeable swipe-target-width="80px">
      <ons-page>
        <ons-splitter id="appSplitter">
          <ons-splitter-content page="tabbar.html"></ons-splitter-content>
        </ons-splitter>
      </ons-page>
    </ons-navigator>

    <template id="tabbar.html">
      <ons-page id="tabbar-page" class="">
        <ons-toolbar>
          <div class="center"><center>Dicionário de Crente</center></div>
        </ons-toolbar>
        <ons-tabbar swipeable id="appTabbar" position="auto">
          <ons-tab label="Home" icon="ion-home" page="home.html" active></ons-tab>
          <ons-tab label="Buscar Palavra" icon="ion-search" page="buscar.html"></ons-tab>
          <ons-tab label="Últimos Registros" icon="fa-newspaper" page="ultimas.html"></ons-tab>
        </ons-tabbar>

        <script>
          ons.getScriptPage().addEventListener('prechange', function(event) { 
            if (event.target.matches('#appTabbar')) {
              event.currentTarget.querySelector('ons-toolbar .center center').innerHTML = 'Dicionário de Crente';
            }
          });
        </script>
      </ons-page>
    </template>

    <!-- MODAL DE AGUARDE -->
    <ons-modal id="modal-aguarde">
      <p style="text-align: center">        
        <ons-icon icon="fa-spinner" spin></ons-icon>
        <br><br>
      </p>
    </ons-modal>

    <template id="home.html">
      <ons-page id="pagina_inicio" class="">
        <input type="hidden" id="OneSignalUserId" value="">
        <input type="hidden" id="OneSignalPushToken" value="">

        <ons-list id="lista_estados">

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'A||Expressões com a letra A'})">
            <div class="left">
              <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_a.png">
            </div>
            <div class="center">Expressões com a letra A</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'B||Expressões com a letra B'})">
            <div class="left">
              <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_b.png">
            </div>
            <div class="center">Expressões com a letra B</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'C||Expressões com a letra C'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_c.png">
              </div>
            <div class="center">Expressões com a letra C</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'D||Expressões com a letra D'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_d.png">
              </div>
            <div class="center">Expressões com a letra D</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'E||Expressões com a letra E'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_e.png">
              </div>
            <div class="center">Expressões com a letra E</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'F||Expressões com a letra F'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_f.png">
              </div>
            <div class="center">Expressões com a letra F</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'G||Expressões com a letra G'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_g.png">
              </div>
            <div class="center">Expressões com a letra G</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'H||Expressões com a letra H'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_h.png">
              </div>
            <div class="center">Expressões com a letra H</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'I||Expressões com a letra I'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_i.png">
              </div>
            <div class="center">Expressões com a letra I</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'J||Expressões com a letra J'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_j.png">
              </div>
            <div class="center">Expressões com a letra J</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'K||Expressões com a letra K'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_k.png">
              </div>
            <div class="center">Expressões com a letra K</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'L||Expressões com a letra L'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_l.png">
              </div>
            <div class="center">Expressões com a letra L</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'M||Expressões com a letra M'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_m.png">
              </div>
            <div class="center">Expressões com a letra M</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'N||Expressões com a letra N'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_n.png">
              </div>
            <div class="center">Expressões com a letra N</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'O||Expressões com a letra O'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_o.png">
              </div>
            <div class="center">Expressões com a letra O</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'P||Expressões com a letra P'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_p.png">
              </div>
            <div class="center">Expressões com a letra P</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'Q||Expressões com a letra Q'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_q.png">
              </div>
            <div class="center">Expressões com a letra Q</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'R||Expressões com a letra R'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_r.png">
              </div>
            <div class="center">Expressões com a letra R</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'S||Expressões com a letra S'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_s.png">
              </div>
            <div class="center">Expressões com a letra S</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'T||Expressões com a letra T'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_t.png">
              </div>
            <div class="center">Expressões com a letra T</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'U||Expressões com a letra U'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_u.png">
              </div>
            <div class="center">Expressões com a letra U</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'V||Expressões com a letra V'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_v.png">
              </div>
            <div class="center">Expressões com a letra V</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'W||Expressões com a letra W'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_w.png">
              </div>
            <div class="center">Expressões com a letra W</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'X||Expressões com a letra X'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_x.png">
              </div>
            <div class="center">Expressões com a letra X</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'Y||Expressões com a letra Y'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_y.png">
              </div>
            <div class="center">Expressões com a letra Y</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>

          <ons-list-item onclick="fn.pushPage({'id': 'listaGirias.html', 'title': 'Z||Expressões com a letra Z'})">
            <div class="left">
                <img class="list-item__thumbnail" style="border: 1px solid #1f1f21;border-radius: 6px;" src="./img/letra_z.png">
              </div>
            <div class="center">Expressões com a letra Z</div>
            <div class="right"><ons-icon icon="fa-angle-right"></ons-icon></div>     
          </ons-list-item>
        </ons-list>

        <ons-speed-dial position="bottom right" direction="up" :open.sync="spdOpen">
          <ons-fab onclick="fn.pushPage({'id': 'enviarGiria.html', 'title': 'Enviar Expressão'})">
            <ons-icon icon="md-plus"></ons-icon>
          </ons-fab>
        </ons-speed-dial>

        <style>
          .button-margin {
            margin: 6px 0;
          }
          .card__title,
          .card--material__title {
            font-size: 20px;
          }
        </style>
      </ons-page>
    </template>

    <template id="listaGirias.html">
      <ons-page>
        <ons-toolbar>
          <div class="left">
            <ons-back-button>Home</ons-back-button>
          </div>
          <div class="center"></div>
        </ons-toolbar>
        <div id='conteudo_girias'></div>
        <ons-fab class="copiar" position="bottom left" style="display: none;">
            <ons-icon icon="md-copy"></ons-icon>
        </ons-fab>

        <ons-speed-dial position="bottom right" direction="up" :open.sync="spdOpen" style="display: none;" class="compartilha">
            <ons-fab class="compartilhar">
                <ons-icon icon="md-share"></ons-icon>
            </ons-fab>
            <ons-speed-dial-item class="compartilhar_whatsapp">
                <ons-icon icon="md-whatsapp"></ons-icon>
            </ons-speed-dial-item>

            <ons-speed-dial-item class="compartilhar_twitter">
                <ons-icon icon="md-twitter"></ons-icon>
            </ons-speed-dial-item>

            <ons-speed-dial-item class="compartilhar_instagram">
                <ons-icon icon="md-instagram"></ons-icon>
            </ons-speed-dial-item>
        </ons-speed-dial>
        <script>
          ons.getScriptPage().onInit = function () {
            var dados = this.data.title.split('||'); 
            admob.interstitial.show();

            //CHAMA DA FUNÇÃO PARA ABRIR MODAL 
            fn.showDialog('modal-aguarde');
            app.buscaGiriaEstado(dados[0]);
            this.querySelector('ons-toolbar div.center').textContent = dados[1];

            $( ".copiar" ).click(function() {
              var text = '';
              $("[marcado=1]").each(function() {
                var txt_giria = $(this).text();
                text += txt_giria+'\n\n';
              });
              text += 'Dicionário de Crente\nLink: http://bit.ly/2Gko7oT';
              cordova.plugins.clipboard.copy(text);
              cordova.plugins.clipboard.paste(function (text) { 
                ons.notification.toast('Copiado para a área de transferência.', { buttonLabel: 'Ok', timeout: 2000 });
              });
              //cordova.plugins.clipboard.clear();
            });

            $( ".compartilhar_whatsapp" ).click(function() {
              var text = '';
              $("[marcado=1]").each(function() {
                var txt_giria = $(this).text();
                text += txt_giria+'\n\n';
              });

              text += 'Dicionário de Crente\nLink: http://bit.ly/2Gko7oT';

              window.plugins.socialsharing.shareViaWhatsApp(
                text, 
                null, 
                null, 
                function() {
                  ons.notification.toast('Compartilhado no WhatsApp.', { buttonLabel: 'Ok', timeout: 2000 });
                }, 
                function(errormsg){
                  ons.notification.toast('Não foi possível compartilhar.', { buttonLabel: 'Ok', timeout: 2000 });
                }
              )
            });

            $( ".compartilhar_instagram" ).click(function() {
              var text = '';
              $("[marcado=1]").each(function() {
                var txt_giria = $(this).text();
                text += txt_giria+'\n\n';
              });

              text += 'Dicionário de Crente\nLink: http://bit.ly/2Gko7oT';
              window.plugins.socialsharing.shareViaInstagram(
                text, 
                null, 
                function() {
                  ons.notification.toast('Compartilhado no Instagram.', { buttonLabel: 'Ok', timeout: 2000 });
                }, 
                function(errormsg){
                  ons.notification.toast('Não foi possível compartilhar.', { buttonLabel: 'Ok', timeout: 2000 });
                }
              )
            });

            $( ".compartilhar_twitter" ).click(function() {
              var text = '';
              $("[marcado=1]").each(function() {
                var txt_giria = $(this).text();
                text += txt_giria+'\n\n';
              });

              text += 'Dicionário de Crente\nLink: http://bit.ly/2Gko7oT';
              window.plugins.socialsharing.shareViaTwitter(text);
            });
          }
        </script>
        <style>
          .button-margin {
            margin: 6px 0;
          }
        </style>
      </ons-page>
    </template>

    <style>
      ons-splitter-side[animation=overlay] {
        border-left: 1px solid #bbb;
      }
    </style>

    <template id="buscar.html">
      <ons-page id="forms-page">
        <ons-search-input 
          style="width: 100%"
          placeholder="Digite uma expressão..."
          onchange="app.onSearchKeyDown(this.value);"
        ></ons-search-input>
          <div id='resultado_girias'></div>
      </ons-page>
    </template>

    <template id="ultimas.html">
      <ons-page id="">
        <div id='ultimas_girias'></div>
        <script>
          ons.getScriptPage().onInit = function () {
            admob.interstitial.show();
            app.ultimasGiriasCadastradas();
          }
        </script>
      </ons-page>
    </template>

    <template id="enviarGiria.html">
      <ons-page>

        <ons-toolbar>
          <div class="left">
            <ons-back-button>Enviar Expressão</ons-back-button>
          </div>
          <div class="center"></div>
        </ons-toolbar>

        <ons-list>
          <br>
          <ons-list-header>Conhece alguma expressão? Compartilhe com a gente!</ons-list-header>
          <ons-list-item class="input-items" style="width: 100%">
            <label class="center">
            <ons-input id="giria_input" placeholder="Expressão" style="width: 100%"></ons-input>
          </label>
          </ons-list-item>

          <ons-list-item class="input-items" style="width: 100%">
            <label class="center">
              <textarea id="significado_giria" class="textarea" rows="3" placeholder="Significado da expressão" style="width: 100%"></textarea>
          </label>
          </ons-list-item>

          <section style="margin: 16px">
            <ons-button type='button' id="cadastrar_giria" modifier="large" class="button-margin">Enviar</ons-button>
          </section>

      </ons-list>
      <script>
        ons.getScriptPage().onInit = function () {
          this.querySelector('ons-toolbar div.center').textContent = this.data.title;
          admob.interstitial.show();
          $( "#cadastrar_giria" ).click(function() {
            if ($( "#giria_input" ).val() === '') {
              ons.notification.alert("Informe o nome da expressão.",{title: 'Ops!'});
              return false;
            }
            else if($( "#significado_giria" ).val() === ''){
              ons.notification.alert("Informe o signifcado da expressão.",{title: 'Ops!'});
              return false;
            }
       
            else{
              fn.showDialog('modal-aguarde');

              var letra = $('#giria_input').val().trim().toUpperCase().substring(0,1);
              app.cadastraGiria($( "#giria_input" ).val(), $( "#significado_giria" ).val(), letra);
              $( "#giria_input" ).val("");
              $( "#significado_giria" ).val("");
            }
          });
        }

      </script>
      </ons-page>
    </template>

    

    <!-- JS dependencies (order matters!) -->
    <script type="text/javascript" src="cordova.js"></script>
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="lib/onsen/js/onsenui.js"></script>
    <script src="lib/SocialSharing/SocialSharing.js"></script>
    <script>
      document.addEventListener('deviceready', function () {
        var userId = localStorage.getItem('userId');
        var pushToken = localStorage.getItem('pushToken');
        if(userId && pushToken){
        }
        else{          
          app.getIds();
        }

        window.plugins.OneSignal
          .startInit('c5518440-c407-4d1d-8105-6bcc6c4a41c8')
          .handleNotificationOpened(function(jsonData) {
            var mensagem = JSON.parse(JSON.stringify(jsonData['notification']['payload']['body']));

            ons.notification.alert(
              mensagem,
              {title: 'Ola!'}
            );
          })
          .inFocusDisplaying(window.plugins.OneSignal.OSInFocusDisplayOption.Notification)
          .endInit();
      }, false);
    </script>
    <script>

      var timeout = 50000;

      window.fn = {};

      window.fn.toggleMenu = function () {
        document.getElementById('appSplitter').right.toggle();
      };

      window.fn.loadView = function (index) {
        document.getElementById('appTabbar').setActiveTab(index);
        document.getElementById('sidemenu').close();
      };

      window.fn.loadLink = function (url) {
        window.open(url, '_blank');
      };

      window.fn.pushPage = function (page, anim) {
        if (anim) {
          document.getElementById('appNavigator').pushPage(page.id, { data: { title: page.title }, animation: anim });
        } else {
          document.getElementById('appNavigator').pushPage(page.id, { data: { title: page.title } });
        }
      };

      // SCRIPT PARA CRIAR O MODAL DE AGUARDE
      window.fn.showDialog = function (id) {
        var elem = document.getElementById(id);      
        elem.show();            
      };

      //SCRIPT PARA ESCONDER O MODAL DE AGUARDE
      window.fn.hideDialog = function (id) {
        document.getElementById(id).hide();
      };

      var app = {
        // Application Constructor
        initialize: function() {
          document.addEventListener('deviceready', this.onDeviceReady.bind(this), false);
        },
        // deviceready Event Handler    
        // Bind any cordova events here. Common events are:
        // 'pause', 'resume', etc.
        onDeviceReady: function() {          
          this.receivedEvent('deviceready');  
        },
        // Update DOM on a Received Event
        receivedEvent: function(id) {
          initAd();  
          showBannerFunc();
          showInterstitialFunc();
        },
        //FUNÇÃO DE BUSCA
        onSearchKeyDown: function(id) {
          if (id === '') {
            return false;
          }
          else{
            $('#resultado_girias').html("");
            fn.showDialog('modal-aguarde');
            app.pesquisaGiriaEstado(id);
          }
        },
        buscaGiriaEstado: function(letra) {
          admob.interstitial.show();
          $.ajax({
              url: "https://www.innovatesoft.com.br/webservice/giriasdecrente/buscaGiria.php",
              dataType: 'json',
              type: 'GET',
              timeout: parseInt(timeout),
              data: {
                'letra': letra
              },
              error: function(a) {
                var timeoutID = 0;
                clearTimeout(timeoutID);
                timeoutID = setTimeout(function() { fn.hideDialog('modal-aguarde') }, 1);
                ons.notification.alert("Não foi possível buscar as expressões no momento.",{title: 'Ops!'});
              },
              success: function(valorRetornado) {
                console.log(valorRetornado)
                var timeoutID = 0;
                clearTimeout(timeoutID);
                timeoutID = setTimeout(function() { fn.hideDialog('modal-aguarde') }, 1);
                if (valorRetornado == "ERROR") {
                  ons.notification.alert("Não foi possível buscar as expressões.",{title: 'Ops!'});
                }
                else{  
                  var obj = valorRetornado;
                  if (obj) {
                    for(var i in obj) {
                      $('#conteudo_girias').append("<ons-card class='txt_giria' id='txt_giria"+i+"' marcado='0'><div class='title'>"+obj[i]['giria']+"\n</div><div class='content'>"+obj[i]['significado']+"</div></ons-card>");
                    }

                    var qtd_marcado = 0;
                    $( ".txt_giria" ).click(function() {
                      var marcado = $(this).attr('marcado');
                      var id = $(this).attr('id');          

                      if(parseInt(marcado) == 0) {
                        $(this).css("background","#f5f5f5");
                        $(this).attr('marcado',1);
                        qtd_marcado++;
                      }
                      else{
                        $(this).css("background","#fff");
                        $(this).attr('marcado',0);
                        qtd_marcado--;
                      }

                      if (parseInt(qtd_marcado) > 0) {
                        $(".copiar").css("display","");
                        $(".compartilha").css("display","");
                      }
                      else{
                        $(".copiar").css("display","none");
                        $(".compartilha").css("display","none");
                      }                    
                    });
                  }
                }
              },
          }); 
        },
        pesquisaGiriaEstado: function(pesquisa) {
          admob.interstitial.show();
          $.ajax({
              url: "https://www.innovatesoft.com.br/webservice/giriasdecrente/buscaGiria.php",
              dataType: 'json',
              type: 'GET',
              timeout: parseInt(timeout),
              data: {
                'pesquisa': pesquisa
              },
              error: function(a) {
                var timeoutID = 0;
                clearTimeout(timeoutID);
                timeoutID = setTimeout(function() { fn.hideDialog('modal-aguarde') }, 1);
                $('#resultado_girias').append("<ons-card><div class='title'>Ops!</div><div class='content'>Não encontramos nada parecido com essa expressão</div></ons-card>");
              },
              success: function(valorRetornado) { 
                var obj = valorRetornado;
                var timeoutID = 0;
                clearTimeout(timeoutID);
                timeoutID = setTimeout(function() { fn.hideDialog('modal-aguarde') }, 1);
                if (obj) {
                  for(var i in obj) {
                    $('#resultado_girias').append(
                      "<ons-card>"+
                        "<div class='title'>"+obj[i]['giria']+"</div>"+
                        "<div class='content'>"+obj[i]['significado']+"</div>"+
                      "</ons-card>");
                  }
                }
                else{
                  $('#resultado_girias').append("<ons-card><div class='title'>Ops!</div><div class='content'>Não encontramos nada parecido com essa expressão</div></ons-card>");
                }
              },
          }); 
        },
        ultimasGiriasCadastradas: function() {
          admob.interstitial.show();
          $.ajax({
              url: "https://www.innovatesoft.com.br/webservice/giriasdecrente/ultimasGiriasCadastradas.php",
              dataType: 'json',
              type: 'GET',
              timeout: parseInt(timeout),
              data: {
                'ultimasGiriasCadastradas': 'sim'
              },
              error: function(a) {    
                console.log(a)      
                $('#ultimas_girias').append("<ons-card><div class='title'>Ops!</div><div class='content'>Nenhuma expressão cadastrada nos últimos dias.</div></ons-card>");
              },
              success: function(valorRetornado) { 
                var obj = valorRetornado;
                var timeoutID = 0;
                clearTimeout(timeoutID);
                timeoutID = setTimeout(function() { fn.hideDialog('modal-aguarde') }, 1);
                if (obj) {
                  for(var i in obj) {
                    $('#ultimas_girias').append(
                      "<ons-card>"+
                        "<div class='title'>"+obj[i]['giria']+"</div>"+
                        "<div class='content'>"+obj[i]['significado']+"</div>"+
                      "</ons-card>");
                  }
                }
                else{
                  $('#ultimas_girias').append("<ons-card><div class='title'>Ops!</div><div class='content'>Nenhuma expressão cadastrada nos últimos dias.</div></ons-card>");
                }
              },
          }); 
        },
        cadastraGiria: function(giria_input, significado_giria, letra){
          admob.interstitial.show();
          var userId = localStorage.getItem('userId');
          var pushToken = localStorage.getItem('pushToken');
          $.ajax({
              url: "https://www.innovatesoft.com.br/webservice/giriasdecrente/cadastraGiria.php",
              dataType: 'html',
              type: 'POST',
              timeout: parseInt(timeout),
              data: {
                'giria': giria_input,
                'significado': significado_giria,
                'letra': letra,
                'userId': userId,
                'pushToken': pushToken,
              },
              error: function(a) {
                console.log(a)
                var timeoutID = 0;
                clearTimeout(timeoutID);
                timeoutID = setTimeout(function() { fn.hideDialog('modal-aguarde') }, 1);
                ons.notification.alert("Não foi possível enviar sua expressão.",{title: 'Ops!'});
              },
              success: function(valorRetornado) {
                var timeoutID = 0;
                clearTimeout(timeoutID);
                timeoutID = setTimeout(function() { fn.hideDialog('modal-aguarde') }, 1);
                ons.notification.alert("Sua expressão foi cadastrada com sucesso. Ela estará disponível na letra '"+letra+"'.",{title: 'Parabéns!'});
              },
          }); 
        },
        getIds: function() {
          window.plugins.OneSignal.getIds(function(ids) {
            window.localStorage.setItem('userId', ids.userId);
            window.localStorage.setItem('pushToken', ids.pushToken);

            $("#OneSignalUserId").val(ids.userId);
            $("#OneSignalPushToken").val(ids.pushToken);

            var userId = localStorage.getItem('userId');
            var pushToken = localStorage.getItem('pushToken');
            app.cadastraUser();
          });       
        },
        cadastraUser: function() {
          var userId = $("#OneSignalUserId").val();
          var pushToken = $("#OneSignalPushToken").val();

          $.ajax({
            url: "https://www.innovatesoft.com.br/webservice/giriasdecrente/cadastraUser.php",
            dataType: 'html',
            type: 'POST',
            data: {
              'userId': userId,
              'pushToken': pushToken,
            },
            error: function(a) {
              alert(a);
            },
            success: function(valorRetornado) {
              //alert(valorRetornado);
            },
          });
        }
      };
      app.initialize();
    </script>    
</body>

</html>
